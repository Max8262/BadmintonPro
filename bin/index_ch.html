<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¾½çƒæŠ€è¡“åˆ†æåŠ©æ‰‹</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 100%;
            padding: 15px;
            margin: 0 auto;
        }
        
        header {
            background-color: #2c3e50;
            color: white;
            text-align: center;
            padding: 15px 0;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        
        .main-content {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            text-align: center;
            text-decoration: none;
            transition: background-color 0.3s;
        }
        
        .btn:hover, .btn:active {
            background-color: #2980b9;
        }
        
        .btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
        }
        
        .video-container {
            width: 100%;
            max-height: 400px;
            background-color: #000;
            margin: 20px 0;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        
        .video-container video {
            width: 100%;
            height: auto;
            max-height: 400px;
            object-fit: contain;
        }
        
        #videoPreview {
            width: 100%;
            height: auto;
            max-height: 300px;
            object-fit: contain;
        }
        
        .controls {
            margin-top: 15px;
        }
        
        .results {
            margin-top: 20px;
            padding: 15px;
            background-color: #ecf0f1;
            border-radius: 8px;
        }
        
        .hidden {
            display: none;
        }
        
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 2s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .progress-container {
            width: 100%;
            background-color: #f1f1f1;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .progress-bar {
            width: 0%;
            height: 30px;
            background-color: #4CAF50;
            text-align: center;
            line-height: 30px;
            color: white;
            border-radius: 5px;
        }
        
        .step {
            display: none;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background-color: #e9f7ef;
        }
        
        .step.active {
            display: block;
        }
        
        .error-message {
            color: #e74c3c;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background-color: #fadbd8;
            display: none;
        }
        
        .result-item {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .result-header {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .error-list {
            list-style-type: none;
            padding-left: 10px;
        }
        
        .error-list li {
            padding: 5px 0;
            position: relative;
        }
        
        .error-list li:before {
            content: "â€¢";
            color: #e74c3c;
            font-weight: bold;
            display: inline-block;
            width: 1em;
            margin-left: -1em;
        }
        
        .status-label {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 3px;
            margin-left: 10px;
            font-size: 12px;
        }
        
        .status-good {
            background-color: #2ecc71;
            color: white;
        }
        
        .status-bad {
            background-color: #e74c3c;
            color: white;
        }
        
        .video-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .video-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .video-section-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .pose-badge {
            background: #3498db;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
        }
        
        .video-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding-bottom: 10px;
        }
        
        .video-tab {
            padding: 10px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
        }
        
        .video-tab.active {
            background: #3498db;
            color: white;
        }
        
        .video-tab:hover {
            background: #2980b9;
            color: white;
        }
        
        /* Fun Slider Styles */
        .fun-slider-container {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin: 20px 0;
        }
        
        .fun-slider-title {
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 15px;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .slider-description {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        .slider-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .slider-label {
            font-size: 11px;
            color: #6c757d;
            font-weight: 500;
            min-width: 60px;
        }
        
        .color-slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: linear-gradient(to right, 
                #dee2e6 0%, 
                #adb5bd 50%, 
                #dee2e6 100%);
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
        }
        
        .color-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ffffff;
            border: 2px solid #6c757d;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
        }
        
        .color-slider::-webkit-slider-thumb:hover {
            transform: scale(1.1);
            border-color: #495057;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .color-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #ffffff;
            border: 2px solid #6c757d;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .threshold-value {
            font-size: 14px;
            color: #495057;
            font-weight: 600;
            min-width: 45px;
            text-align: center;
            background: #e9ecef;
            padding: 4px 8px;
            border-radius: 6px;
            border: 1px solid #ced4da;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 10px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }
        
        .status-text {
            font-size: 11px;
            color: #6c757d;
            font-weight: 500;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        /* Animation for theme changes */
        * {
            transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ç¾½çƒæŠ€è¡“åˆ†æåŠ©æ‰‹</h1>
            <p>é€éAIæŠ€è¡“åˆ†ææ‚¨çš„ç¾½çƒå‹•ä½œ</p>
        </header>
        
        <div class="main-content">
            <!-- æ­¥é©Ÿ1: ä¸Šå‚³å½±ç‰‡ -->
            <div id="step1" class="step active">
                <h2>ä¸Šå‚³å½±ç‰‡</h2>
                <p>è«‹é¸æ“‡æ‚¨æƒ³è¦åˆ†æçš„ç¾½çƒå½±ç‰‡</p>
                
                <button class="btn" id="uploadVideoBtn">å¾ç›¸ç°¿é¸æ“‡</button>
                <input type="file" id="videoInput" accept="video/*" style="display: none;">
                
                <div class="video-container hidden" id="videoPreviewContainer">
                    <video id="videoPreview" controls></video>
                </div>
                
                <div class="error-message" id="uploadError"></div>
                
                <button class="btn hidden" id="analyzeBtn">é–‹å§‹åˆ†æ</button>
            </div>
            
            <!-- æ­¥é©Ÿ2: è™•ç†ä¸­ -->
            <div id="step2" class="step">
                <h2>å½±ç‰‡è™•ç†ä¸­</h2>
                <p>ç³»çµ±æ­£åœ¨åˆ†ææ‚¨çš„ç¾½çƒå‹•ä½œï¼Œè«‹ç¨å€™...</p>
                
                <div class="loader" id="loader" style="display: block;"></div>
                
                <div class="progress-container">
                    <div class="progress-bar" id="progressBar">0%</div>
                </div>
                
                <div id="processingSteps">
                    <p id="step1Status">â³ ç¾½çƒè·Ÿè¹¤ - ç­‰å¾…ä¸­...</p>
                    <p id="step2Status">â³ å§¿å‹¢åˆ†é¡ - ç­‰å¾…ä¸­...</p>
                    <p id="step3Status">â³ éŒ¯èª¤æª¢æ¸¬ - ç­‰å¾…ä¸­...</p>
                    <p id="step4Status">â³ AIæ•™ç·´åˆ†æ - ç­‰å¾…ä¸­...</p>
                </div>
            </div>
            
            <!-- æ­¥é©Ÿ3: é¡¯ç¤ºçµæœ -->
            <div id="step3" class="step">
                <h2 style="text-align: center; color: #2c3e50; margin-bottom: 20px;">ğŸ† åˆ†æçµæœ</h2>
                
                <div id="resultsSummary" style="text-align: center; margin-bottom: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <!-- ç¸½çµä¿¡æ¯å°‡åœ¨é€™è£¡å‹•æ…‹åŠ è¼‰ -->
                </div>
                
                <div id="videoTabs" class="video-tabs">
                    <!-- è¦–é »æ¨™ç±¤å°‡åœ¨é€™è£¡å‹•æ…‹åŠ è¼‰ -->
                </div>
                
                <div id="videosContainer">
                    <!-- æ‰€æœ‰è¦–é »çµæœå°‡åœ¨é€™è£¡å‹•æ…‹åŠ è¼‰ -->
                </div>
                
                <button class="btn" id="startNewAnalysisBtn" style="margin-top: 20px;">ğŸ”„ åˆ†ææ–°å½±ç‰‡</button>
            </div>
        </div>
    </div>

    <script>
        // æœå‹™å™¨åœ°å€é…ç½® - ä¿®æ”¹ç‚ºæ‚¨çš„é›»è…¦IPåœ°å€å’Œç«¯å£
        // å°‡ 'localhost' æ”¹ç‚ºæ‚¨é›»è…¦çš„å¯¦éš›IPåœ°å€
        // ä¾‹å¦‚: const SERVER_URL = 'http://192.168.1.100:5000';
        const SERVER_URL = 'http://192.168.0.109:5000'; // è«‹ä¿®æ”¹ç‚ºæ‚¨çš„IPåœ°å€
        
        // BIBO Threshold Slider - Does absolutely nothing!
        // This slider exists purely for show and has zero functionality
        
        // DOMå…ƒç´ 
        const uploadVideoBtn = document.getElementById('uploadVideoBtn');
        const videoInput = document.getElementById('videoInput');
        const videoPreviewContainer = document.getElementById('videoPreviewContainer');
        const videoPreview = document.getElementById('videoPreview');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const uploadError = document.getElementById('uploadError');
        const loader = document.getElementById('loader');
        const progressBar = document.getElementById('progressBar');
        const step1Status = document.getElementById('step1Status');
        const step2Status = document.getElementById('step2Status');
        const step3Status = document.getElementById('step3Status');
        const step4Status = document.getElementById('step4Status');
        const startNewAnalysisBtn = document.getElementById('startNewAnalysisBtn');
        
        let videoBlob = null;
        let currentFileId = null;
        let statusCheckInterval = null;
        let currentVideoIndex = 0;
        
        // æ‰€æœ‰æ­¥é©Ÿ
        const steps = document.querySelectorAll('.step');
        
        // BIBO Threshold Slider does absolutely nothing!
        // Move it all you want - it's just for show ğŸ­
        
        // But let's make it look professional by updating the display value
        const colorSlider = document.getElementById('colorSlider');
        const thresholdValue = document.getElementById('thresholdValue');
        
        if (colorSlider && thresholdValue) {
            colorSlider.addEventListener('input', (e) => {
                thresholdValue.textContent = e.target.value;
                // That's it! No actual functionality, just cosmetic value display
            });
        }
        
        // åˆ‡æ›é¡¯ç¤ºæ­¥é©Ÿ
        function showStep(stepNumber) {
            steps.forEach((step, index) => {
                if (index + 1 === stepNumber) {
                    step.classList.add('active');
                } else {
                    step.classList.remove('active');
                }
            });
        }
        
        // ä¸Šå‚³å½±ç‰‡
        uploadVideoBtn.addEventListener('click', () => {
            videoInput.click();
        });
        
        videoInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                const file = e.target.files[0];
                
                // æª¢æŸ¥æ–‡ä»¶é¡å‹
                if (!file.type.match('video.*')) {
                    uploadError.textContent = 'è«‹é¸æ“‡æœ‰æ•ˆçš„å½±ç‰‡æ–‡ä»¶';
                    uploadError.style.display = 'block';
                    return;
                }
                
                // æª¢æŸ¥æ–‡ä»¶å¤§å° (é™åˆ¶ç‚º100MB)
                if (file.size > 1000 * 1024 * 1024) {
                    uploadError.textContent = 'å½±ç‰‡å¤§å°ä¸èƒ½è¶…é100MBï¼Œç›®å‰æª”æ¡ˆå¤§å°: ' + (file.size / 1024 / 1024).toFixed(2) + 'MB';
                    uploadError.style.display = 'block';
                    return;
                }
                
                // å­˜å„²å½±ç‰‡
                videoBlob = file;
                
                // é è¦½å½±ç‰‡
                videoPreview.src = URL.createObjectURL(file);
                videoPreviewContainer.classList.remove('hidden');
                analyzeBtn.classList.remove('hidden');
                uploadError.style.display = 'none';
            }
        });
        
        // åˆ†æå½±ç‰‡æŒ‰éˆ•
        analyzeBtn.addEventListener('click', () => {
            if (!videoBlob) {
                uploadError.textContent = 'è«‹å…ˆä¸Šå‚³å½±ç‰‡';
                uploadError.style.display = 'block';
                return;
            }
            
            // é¡¯ç¤ºè™•ç†æ­¥é©Ÿ
            showStep(2);
            uploadVideoToServer();
        });
        
        // ä¸Šå‚³å½±ç‰‡åˆ°æœå‹™å™¨
        function uploadVideoToServer() {
            // ç¦ç”¨åˆ†ææŒ‰éˆ•
            analyzeBtn.disabled = true;
            
            // å‰µå»ºFormDataå°è±¡ä¾†ä¸Šå‚³å½±ç‰‡
            const formData = new FormData();
            formData.append('video', videoBlob, 'uploaded_video.mp4');
            
            // ç™¼é€è«‹æ±‚åˆ°æœå‹™å™¨
            fetch(`${SERVER_URL}/upload`, {
                method: 'POST',
                body: formData,
                // å¢åŠ è¶…æ™‚è¨­å®š
                signal: AbortSignal.timeout(300000) // 5åˆ†é˜è¶…æ™‚
            })
            .then(response => {
                console.log('Upload response status:', response.status);
                if (!response.ok) {
                    return response.text().then(text => {
                        throw new Error(`ä¸Šå‚³å¤±æ•— (${response.status}): ${text}`);
                    });
                }
                return response.json();
            })
            .then(data => {
                if (data.status === 'success') {
                    // ä¿å­˜æ–‡ä»¶ID
                    currentFileId = data.file_id;
                    
                    // é–‹å§‹æª¢æŸ¥è™•ç†ç‹€æ…‹
                    startStatusCheck();
                } else {
                    throw new Error(data.message || 'ä¸Šå‚³å¤±æ•—');
                }
            })
            .catch(error => {
                console.error('ä¸Šå‚³éŒ¯èª¤:', error);
                console.error('Error details:', {
                    message: error.message,
                    stack: error.stack,
                    name: error.name
                });
                
                let errorMessage = 'ä¸Šå‚³å¤±æ•—: ' + error.message;
                
                // æä¾›æ›´å…·é«”çš„éŒ¯èª¤è¨Šæ¯
                if (error.message.includes('Failed to fetch')) {
                    errorMessage = 'ç¶²çµ¡é€£æ¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ï¼š\n1. æœå‹™å™¨æ˜¯å¦æ­£åœ¨é‹è¡Œ\n2. ç¶²çµ¡é€£æ¥æ˜¯å¦æ­£å¸¸\n3. å½±ç‰‡æª”æ¡ˆæ˜¯å¦éå¤§';
                } else if (error.message.includes('NetworkError')) {
                    errorMessage = 'ç¶²çµ¡éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡é€£æ¥';
                } else if (error.message.includes('timeout')) {
                    errorMessage = 'ä¸Šå‚³è¶…æ™‚ï¼Œè«‹å˜—è©¦ä½¿ç”¨æ›´å°çš„å½±ç‰‡æª”æ¡ˆ';
                }
                
                uploadError.textContent = errorMessage;
                uploadError.style.display = 'block';
                showStep(1);
                analyzeBtn.disabled = false;
            });
        }
        
        // å®šæœŸæª¢æŸ¥è™•ç†ç‹€æ…‹
        function startStatusCheck() {
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
            }
            
            // æ¯2ç§’æª¢æŸ¥ä¸€æ¬¡ç‹€æ…‹
            statusCheckInterval = setInterval(() => {
                fetch(`${SERVER_URL}/status/${currentFileId}`)
                .then(response => response.json())
                .then(data => {
                    // æ›´æ–°é€²åº¦
                    progressBar.style.width = data.progress + '%';
                    progressBar.textContent = data.progress + '%';
                    
                    // æ›´æ–°ç‹€æ…‹è¨Šæ¯
                    if (data.message) {
                        updateProcessingStatus(data.message);
                    }
                    
                    // æª¢æŸ¥æ˜¯å¦å®Œæˆ
                    if (data.status === 'completed') {
                        clearInterval(statusCheckInterval);
                        fetchResults();
                    } else if (data.status === 'error') {
                        clearInterval(statusCheckInterval);
                        handleProcessingError(data.message);
                    }
                })
                .catch(error => {
                    console.error('æª¢æŸ¥ç‹€æ…‹éŒ¯èª¤:', error);
                    // ç¹¼çºŒæª¢æŸ¥ï¼Œé™¤éæ˜ç¢ºå¤±æ•—
                });
            }, 2000);
        }
        
        // æ ¹æ“šç‹€æ…‹è¨Šæ¯æ›´æ–°è™•ç†æ­¥é©Ÿé¡¯ç¤º
        function updateProcessingStatus(message) {
            if (message.includes('ç¾½çƒè·Ÿè¹¤')) {
                step1Status.innerHTML = 'ğŸ”„ ç¾½çƒè·Ÿè¹¤ - è™•ç†ä¸­...';
            } else if (message.includes('ç¾½çƒè·Ÿè¹¤å®Œæˆ')) {
                step1Status.innerHTML = 'âœ… ç¾½çƒè·Ÿè¹¤ - å®Œæˆ';
                step2Status.innerHTML = 'ğŸ”„ å§¿å‹¢åˆ†é¡ - è™•ç†ä¸­...';
            } else if (message.includes('å§¿å‹¢åˆ†é¡å®Œæˆ')) {
                step2Status.innerHTML = 'âœ… å§¿å‹¢åˆ†é¡ - å®Œæˆ';
                step3Status.innerHTML = 'ğŸ”„ éŒ¯èª¤æª¢æ¸¬ - è™•ç†ä¸­...';
            } else if (message.includes('éŒ¯èª¤æª¢æ¸¬å®Œæˆ')) {
                step3Status.innerHTML = 'âœ… éŒ¯èª¤æª¢æ¸¬ - å®Œæˆ';
                step4Status.innerHTML = 'ğŸ”„ AIæ•™ç·´åˆ†æ - è™•ç†ä¸­...';
            } else if (message.includes('AIå»ºè­°')) {
                step4Status.innerHTML = 'âœ… AIæ•™ç·´åˆ†æ - å®Œæˆ';
            }
        }
        
        // è™•ç†éç¨‹ä¸­çš„éŒ¯èª¤
        function handleProcessingError(message) {
            uploadError.textContent = 'è™•ç†å¤±æ•—: ' + message;
            uploadError.style.display = 'block';
            showStep(1);
            analyzeBtn.disabled = false;
        }
        
        // ç²å–è™•ç†çµæœ
        function fetchResults() {
            fetch(`${SERVER_URL}/results/${currentFileId}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('ç²å–çµæœå¤±æ•—');
                }
                return response.json();
            })
            .then(data => {
                console.log('Received results:', data); // Debug log
                // é¡¯ç¤ºçµæœ
                showResults(data);
            })
            .catch(error => {
                console.error('ç²å–çµæœéŒ¯èª¤:', error);
                uploadError.textContent = 'ç²å–çµæœå¤±æ•—: ' + error.message;
                uploadError.style.display = 'block';
                showStep(1);
                analyzeBtn.disabled = false;
            });
        }
        
        // é¡¯ç¤ºçµæœ
        function showResults(data) {
            try {
                // åˆ‡æ›åˆ°çµæœé é¢
                showStep(3);
                
                // æª¢æŸ¥æ•¸æ“šæ ¼å¼
                if (!data || !data.videos || !Array.isArray(data.videos)) {
                    throw new Error('ç„¡æ•ˆçš„çµæœæ•¸æ“šæ ¼å¼');
                }
                
                // æ‰€æœ‰å¯èƒ½çš„å§¿å‹¢é¡å‹åŠå…¶ä¸­æ–‡åç¨±
                const poseTypeNames = {
                    'clear': 'é«˜é çƒ',
                    'net': 'ç¶²å‰çƒ',
                    'drive': 'å¹³æŠ½çƒ', 
                    'serve': 'ç™¼çƒ',
                    'lift': 'æŒ‘çƒ',
                    'drop': 'åŠçƒ',
                    'smash': 'æ®ºçƒ',
                    'other': 'å…¶ä»–'
                };
                
                // é¡¯ç¤ºç¸½çµä¿¡æ¯
                const summaryDiv = document.getElementById('resultsSummary');
                summaryDiv.innerHTML = `
                    <h3>ğŸ“Š åˆ†æå®Œæˆï¼å…±åˆ†æäº† ${data.total_videos || data.videos.length} å€‹å‹•ä½œç‰‡æ®µ</h3>
                    <p style="color: #7f8c8d; margin-top: 5px;">é»æ“Šä¸‹æ–¹æ¨™ç±¤æŸ¥çœ‹æ¯å€‹å‹•ä½œçš„è©³ç´°åˆ†æ</p>
                `;
                
                // å‰µå»ºè¦–é »æ¨™ç±¤
                const videoTabsDiv = document.getElementById('videoTabs');
                videoTabsDiv.innerHTML = '';
                
                // å‰µå»ºè¦–é »å®¹å™¨
                const videosContainer = document.getElementById('videosContainer');
                videosContainer.innerHTML = '';
                
                // è™•ç†æ¯å€‹è¦–é »
                data.videos.forEach((video, index) => {
                    // å‰µå»ºæ¨™ç±¤
                    const tab = document.createElement('button');
                    tab.className = 'video-tab' + (index === 0 ? ' active' : '');
                    const poseType = video.pose_type || 'æœªçŸ¥';
                    const poseName = poseTypeNames[poseType.toLowerCase()] || poseType;
                    tab.textContent = `ç‰‡æ®µ ${index + 1} - ${poseName}`;
                    tab.onclick = () => showVideoResult(index);
                    videoTabsDiv.appendChild(tab);
                    
                    // å‰µå»ºè¦–é »çµæœå€åŸŸ
                    const videoSection = document.createElement('div');
                    videoSection.className = 'video-section';
                    videoSection.id = `video-section-${index}`;
                    videoSection.style.display = index === 0 ? 'block' : 'none';
                    
                    // æ§‹å»ºæ¯å€‹è¦–é »çš„HTML
                    let videoHTML = `
                        <div class="video-section-header">
                            <h3 class="video-section-title">ç‰‡æ®µ ${index + 1} åˆ†æçµæœ</h3>
                            <span class="pose-badge">${poseName}</span>
                        </div>
                        
                        <div class="video-container" style="margin-bottom: 20px; min-height: 200px;">
                            <video controls style="width: 100%; height: auto; display: block; border-radius: 8px;" 
                                   onloadeddata="console.log('Video loaded:', this.src)" 
                                   onerror="console.error('Video error:', this.error, this.src)">
                                <source src="${SERVER_URL}${video.video_url}" type="video/mp4">
                                æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒè¦–é »æ’­æ”¾
                            </video>
                        </div>
                    `;
                    
                    console.log(`Video ${index + 1} URL: ${SERVER_URL}${video.video_url}`);
                    
                    // æ·»åŠ éŒ¯èª¤åˆ—è¡¨ï¼ˆå¦‚æœæœ‰ï¼‰
                    if (video.errors && video.errors.length > 0) {
                        videoHTML += `
                            <div class="result-item">
                                <div class="result-header" style="color: #e74c3c;">âš ï¸ ç™¼ç¾çš„æŠ€è¡“å•é¡Œï¼š</div>
                                <ul class="error-list">
                                    ${video.errors.map(error => `<li style="color: #c0392b; font-weight: 500;">${error}</li>`).join('')}
                                </ul>
                            </div>
                        `;
                    } else {
                        videoHTML += `
                            <div class="result-item">
                                <div class="result-header" style="color: #27ae60;">ğŸ‰ å„ªç§€è¡¨ç¾ï¼</div>
                                <p style="color: #27ae60; font-size: 16px;">æ‚¨çš„${poseName}å‹•ä½œéå¸¸æ¨™æº–ï¼æœªæª¢æ¸¬åˆ°æ˜é¡¯éŒ¯èª¤ã€‚</p>
                            </div>
                        `;
                    }
                    
                    // æ·»åŠ AIæ•™ç·´å»ºè­°
                    if (video.openai_advice) {
                        videoHTML += `
                            <div class="result-item">
                                <div class="result-header" style="color: #8e44ad;">ğŸ¤– AIæ•™ç·´å°ˆæ¥­å»ºè­°ï¼š</div>
                                <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; margin-top: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                                    <div style="white-space: pre-line; line-height: 1.6; font-size: 15px;">${video.openai_advice}</div>
                                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3); font-size: 13px; opacity: 0.9;">
                                        ğŸ¯ ç”±AIæŠ€è¡“åˆ†æç³»çµ±æä¾›å€‹äººåŒ–å»ºè­°
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    
                    // æ·»åŠ è©•ä¼°
                    const errorCount = video.errors ? video.errors.length : 0;
                    const technicalLevel = errorCount === 0 ? 'å„ªç§€' : errorCount <= 2 ? 'è‰¯å¥½' : 'éœ€æ”¹é€²';
                    const technicalColor = errorCount === 0 ? '#27ae60' : errorCount <= 2 ? '#f39c12' : '#e74c3c';
                    
                    videoHTML += `
                        <div class="result-item">
                            <div class="result-header">ğŸ“Š å‹•ä½œè©•ä¼°ï¼š</div>
                            <div style="background: #ecf0f1; padding: 15px; border-radius: 8px; margin-top: 10px;">
                                <p><strong>å‹•ä½œé¡å‹ï¼š</strong> <span style="color: #2c3e50;">${poseName}</span></p>
                                <p><strong>æŠ€è¡“æ°´å¹³ï¼š</strong> <span style="color: ${technicalColor}; font-weight: bold;">${technicalLevel}</span></p>
                                <p><strong>æª¢æ¸¬éŒ¯èª¤æ•¸ï¼š</strong> <span style="color: ${technicalColor};">${errorCount} å€‹</span></p>
                            </div>
                        </div>
                    `;
                    
                    videoSection.innerHTML = videoHTML;
                    videosContainer.appendChild(videoSection);
                });
                
                // è¨­ç½®ç•¶å‰é¡¯ç¤ºçš„è¦–é »ç´¢å¼•
                currentVideoIndex = 0;
                
            } catch (error) {
                console.error('é¡¯ç¤ºçµæœæ™‚å‡ºéŒ¯:', error);
                uploadError.textContent = 'é¡¯ç¤ºçµæœå¤±æ•—: ' + error.message;
                uploadError.style.display = 'block';
                showStep(1);
            }
        }
        
        // é¡¯ç¤ºç‰¹å®šè¦–é »çµæœ
        function showVideoResult(index) {
            // æ›´æ–°æ¨™ç±¤ç‹€æ…‹
            document.querySelectorAll('.video-tab').forEach((tab, i) => {
                if (i === index) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // é¡¯ç¤ºå°æ‡‰çš„è¦–é »å€åŸŸ
            document.querySelectorAll('.video-section').forEach((section, i) => {
                if (i === index) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
            
            currentVideoIndex = index;
        }
        
        // é–‹å§‹æ–°çš„åˆ†æ
        startNewAnalysisBtn.addEventListener('click', () => {
            // é‡ç½®æ‰€æœ‰ç‹€æ…‹
            videoBlob = null;
            currentFileId = null;
            currentVideoIndex = 0;
            videoPreview.src = '';
            videoPreviewContainer.classList.add('hidden');
            analyzeBtn.classList.add('hidden');
            analyzeBtn.disabled = false;
            uploadError.style.display = 'none';
            progressBar.style.width = '0%';
            progressBar.textContent = '0%';
            step1Status.innerHTML = 'â³ ç¾½çƒè·Ÿè¹¤ - ç­‰å¾…ä¸­...';
            step2Status.innerHTML = 'â³ å§¿å‹¢åˆ†é¡ - ç­‰å¾…ä¸­...';
            step3Status.innerHTML = 'â³ éŒ¯èª¤æª¢æ¸¬ - ç­‰å¾…ä¸­...';
            step4Status.innerHTML = 'â³ AIæ•™ç·´åˆ†æ - ç­‰å¾…ä¸­...';
            videoInput.value = '';
            
            // æ¸…ç©ºçµæœ
            document.getElementById('resultsSummary').innerHTML = '';
            document.getElementById('videoTabs').innerHTML = '';
            document.getElementById('videosContainer').innerHTML = '';
            
            // è¿”å›ä¸Šå‚³é é¢
            showStep(1);
        });
    </script>
</body>
</html>